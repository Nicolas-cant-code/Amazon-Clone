{"ast":null,"code":"import ShoppingContext from\"./shopping/ShoppingContext\";import React,{useState,useContext,useEffect}from\"react\";import{Link,useHistory}from\"react-router-dom\";import Checkout from\"./Checkout\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import axios from\"../axios\";import\"./Payment.css\";import{db}from\"../firebase\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Payment=()=>{const shoppingContext=useContext(ShoppingContext);const{basket,user,getBasketTotal,emptyBasket}=shoppingContext;const stripe=useStripe();const elements=useElements();const history=useHistory();const[succeeded,setSucceeded]=useState(false);const[processing,setProcessing]=useState(\"\");const[error,setError]=useState(null);const[disabled,setDisabled]=useState(false);const[clientSecret,setClientSecret]=useState(true);useEffect(()=>{// Generate the special stripe secret which allows us to charge a customer\nconst getClientSecret=async()=>{try{const response=await axios({method:\"post\",url:`/payments/create?total=${getBasketTotal(basket)*100}`});setClientSecret(response.data.clientSecret);}catch(error){console.error(\"Error fetching client secret:\",error);}};getClientSecret();},[basket]);// console.log(\"The secret is >>> \", clientSecret);\nconst handleSubmit=async event=>{event.preventDefault();setProcessing(true);const payload=await stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(_ref=>{let{paymentIntent}=_ref;// paymentIntent = payment confirmation\n// Store the order in the database\ndb.collection(\"user\").doc(user===null||user===void 0?void 0:user.uid).collection(\"orders\").doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);//Empty the basket\nemptyBasket();// Redirect to orders page\nhistory.push(\"/orders\");});};const handleChange=event=>{setDisabled(event.empty);setError(event.error?event.error.message:\"\");};const formatCurrency=value=>{return new Intl.NumberFormat(\"en-ZA\",{style:\"currency\",currency:\"ZAR\"// South African Rand\n}).format(value);};return/*#__PURE__*/_jsx(\"div\",{className:\"payments\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout \",/*#__PURE__*/_jsx(Link,{to:\"/final-checkout\",children:basket===null||basket===void 0?void 0:basket.length}),\" Items\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_address\",children:[/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"123 React Lane\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Cape Town, SA\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment_title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_items\",children:basket.map(item=>/*#__PURE__*/_jsx(Checkout,{id:item.id,title:item.title,image:item.image,rating:item.rating,price:item.price},item.id))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment_title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"}),/*#__PURE__*/_jsx(\"div\",{className:\"payment_details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment_price_container\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Order Total: \",formatCurrency(getBasketTotal(basket))]}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing...\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})})]})});};export default Payment;","map":{"version":3,"names":["ShoppingContext","React","useState","useContext","useEffect","Link","useHistory","Checkout","CardElement","useStripe","useElements","axios","db","jsx","_jsx","jsxs","_jsxs","Payment","shoppingContext","basket","user","getBasketTotal","emptyBasket","stripe","elements","history","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","response","method","url","data","console","handleSubmit","event","preventDefault","payload","confirmCardPayment","payment_method","card","getElement","then","_ref","paymentIntent","collection","doc","uid","id","set","amount","created","push","handleChange","empty","message","formatCurrency","value","Intl","NumberFormat","style","currency","format","className","children","to","length","email","map","item","title","image","rating","price","onSubmit","onChange"],"sources":["C:/Zaio work/amazone-clone/amazone-clone/src/component/Payment.js"],"sourcesContent":["import ShoppingContext from \"./shopping/ShoppingContext\";\r\nimport React, { useState, useContext, useEffect } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport Checkout from \"./Checkout\";\r\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\r\nimport axios from \"../axios\";\r\nimport \"./Payment.css\";\r\nimport { db } from \"../firebase\";\r\n\r\nconst Payment = () => {\r\n  const shoppingContext = useContext(ShoppingContext);\r\n  const { basket, user, getBasketTotal, emptyBasket } = shoppingContext;\r\n\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const history = useHistory();\r\n\r\n  const [succeeded, setSucceeded] = useState(false);\r\n  const [processing, setProcessing] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const [disabled, setDisabled] = useState(false);\r\n  const [clientSecret, setClientSecret] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Generate the special stripe secret which allows us to charge a customer\r\n    const getClientSecret = async () => {\r\n      try {\r\n        const response = await axios({\r\n          method: \"post\",\r\n          url: `/payments/create?total=${getBasketTotal(basket) * 100}`,\r\n        });\r\n        setClientSecret(response.data.clientSecret);\r\n      } catch (error) {\r\n        console.error(\"Error fetching client secret:\", error);\r\n      }\r\n    };\r\n    getClientSecret();\r\n  }, [basket]);\r\n\r\n  // console.log(\"The secret is >>> \", clientSecret);\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    setProcessing(true);\r\n\r\n    const payload = await stripe\r\n      .confirmCardPayment(clientSecret, {\r\n        payment_method: {\r\n          card: elements.getElement(CardElement),\r\n        },\r\n      })\r\n      .then(({ paymentIntent }) => {\r\n        // paymentIntent = payment confirmation\r\n        // Store the order in the database\r\n        db.collection(\"user\")\r\n          .doc(user?.uid)\r\n          .collection(\"orders\")\r\n          .doc(paymentIntent.id)\r\n          .set({\r\n            basket: basket,\r\n            amount: paymentIntent.amount,\r\n            created: paymentIntent.created,\r\n          });\r\n\r\n        setSucceeded(true);\r\n        setError(null);\r\n        setProcessing(false);\r\n\r\n        //Empty the basket\r\n        emptyBasket();\r\n\r\n        // Redirect to orders page\r\n        history.push(\"/orders\");\r\n      });\r\n  };\r\n\r\n  const handleChange = (event) => {\r\n    setDisabled(event.empty);\r\n    setError(event.error ? event.error.message : \"\");\r\n  };\r\n\r\n  const formatCurrency = (value) => {\r\n    return new Intl.NumberFormat(\"en-ZA\", {\r\n      style: \"currency\",\r\n      currency: \"ZAR\", // South African Rand\r\n    }).format(value);\r\n  };\r\n\r\n  return (\r\n    <div className=\"payments\">\r\n      <div className=\"payment_container\">\r\n        <h1>\r\n          Checkout <Link to=\"/final-checkout\">{basket?.length}</Link> Items\r\n        </h1>\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Delivery Address</h3>\r\n          </div>\r\n          <div className=\"payment_address\">\r\n            <p>{user?.email}</p>\r\n            <p>123 React Lane</p>\r\n            <p>Cape Town, SA</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Review items and delivery</h3>\r\n          </div>\r\n          <div className=\"payment_items\">\r\n            {basket.map((item) => (\r\n              <Checkout\r\n                key={item.id}\r\n                id={item.id}\r\n                title={item.title}\r\n                image={item.image}\r\n                rating={item.rating}\r\n                price={item.price}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Payment Method</h3>\r\n            <div className=\"payment_details\">\r\n              {/* Stripe code will go here*/}\r\n              <form onSubmit={handleSubmit}>\r\n                <CardElement onChange={handleChange} />\r\n                <div className=\"payment_price_container\">\r\n                  <strong>\r\n                    Order Total: {formatCurrency(getBasketTotal(basket))}\r\n                  </strong>\r\n                  <button disabled={processing || disabled || succeeded}>\r\n                    <span>{processing ? <p>Processing...</p> : \"Buy Now\"}</span>\r\n                  </button>\r\n                </div>\r\n                {error && <div>{error}</div>}\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Payment;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}